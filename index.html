<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8" />
	<title>The Life of Raimund</title>
	<script type="text/javascript" src="js/phaser.min.js"></script>
	<style type="text/css">
		body {
			margin: 0;
		}
	</style>
</head>
<body>

<script type="text/javascript">

var raimund = {};

var PLAYER_GRAVITY = 320;

raimund.gameState = function() {
	this.blocks;
	this.walls;
	this.foods;
	this.player;
	this.cursors;
	this.score = 0;
	this.scoreText;
	this.startTime = 0;
	this.timeText;
	this.sound;
	this.started = false;
	this.winFood;
}

raimund.gameState.prototype.preload = function() {
}




raimund.gameState.prototype.create = function() {
	this.started = false;
	this.physics.startSystem(Phaser.Physics.ARCADE);

	this.sound = this.add.audio('bg-sound');
	this.sound.loop = true;


	this.add.sprite(0, 0, 'background');

	this.blocks = this.add.group();
	this.blocks.enableBody = true;
	
	this.walls = this.add.group();
	this.walls.enableBody = true;

	var blocksMap = [
		[0, this.world.height -58, 'block800'],
		[900, this.world.height -200, 'block200'],
		[320, this.world.height -340, 'block400'],
		[60, this.world.height -450, 'block50'],
		[300, this.world.height -590, 'block100'],
		[0, this.world.height -745, 'block200'],
		[450, this.world.height -815, 'block300'],
		[650, this.world.height -540, 'block400'],
		[1250, this.world.height -600, 'block100'],
		[1470, this.world.height -755, 'block50'],
		[1750, this.world.height -780, 'block50'],
		[1660, this.world.height -600, 'block50'],
		[1860, this.world.height -300, 'block50'],
		[1630, this.world.height -352, 'block50'],
		[1415, this.world.height -350, 'block50'],
		[1130, this.world.height -300, 'block100'],
		[1295, this.world.height -70, 'block50'],
		[1600, this.world.height -43, 'block50'],
		[1800, this.world.height -54, 'block50']
	];

	for(var i = 0; i < blocksMap.length; i++) {
		var block = this.blocks.create(blocksMap[i][0], blocksMap[i][1], blocksMap[i][2]);
		block.body.immovable = true;
	}

	var wallsMap = [
		[650, this.world.height -757, 'wand217'],
		[1100, this.world.height -620, 'wand580'],
		[1100, this.world.height -970, 'wand150'],
		[1620, this.world.height -790, 'wand217'],
		[1765, this.world.height -110, 'wand150'],
		[1855, this.world.height -110, 'wand150'],
		[1130, this.world.height -620, 'wandho115'],
		[1350, this.world.height -620, 'wandho115'],
		[1468, this.world.height -677, 'wand80'],
		[1804, this.world.height -763, 'wandho115'],
		[1475, this.world.height -395, 'wandho150'],
		[1700, this.world.height -320, 'wandho150'],
		[1710, this.world.height -580, 'wand30'],
		[1300, this.world.height -350, 'wandho115']
	];

	for(var i = 0; i < wallsMap.length; i++) {
		var wall = this.walls.create(wallsMap[i][0], wallsMap[i][1], wallsMap[i][2]);
		wall.body.immovable = true;
	}	
	
	this.player = this.add.sprite(20, this.world.height -200, 'bimbo')
	this.physics.arcade.enable(this.player);
	this.player.body.bounce.y = 0;
	this.player.body.gravity.y = PLAYER_GRAVITY;
	
	this.player.animations.add('left', [0, 1, 2, 3], 10, true);
	this.player.animations.add('right', [5, 6, 7, 8], 10, true);

	
	
	this.foods = this.add.group();
	
	this.foods.enableBody = true;

	var foodsMap = [
		//[100, this.world.height -400, 'schoki'],
		[180, this.world.height -390, 'donut'],
		[260, this.world.height -390, 'schnitten'],
		[340, this.world.height -285, 'muffin'],
		[420, this.world.height -285, 'schoki'],
		[500, this.world.height -285, 'donut'],
		[580, this.world.height -285, 'schnitten'],
		[660, this.world.height -285, 'muffin'],
		[740, this.world.height -390, 'schoki'],
		[900, this.world.height -485, 'donut'],
		[980, this.world.height -485, 'schnitten'],
		[1060, this.world.height -485, 'muffin'],
		[670, this.world.height -485, 'muffin'],
		[590, this.world.height -600, 'schoki'],
		[505, this.world.height -600, 'donut'],
		[420, this.world.height -600, 'schnitten'],
		[330, this.world.height -530, 'muffin'],
		[70, this.world.height -660, 'schoki'],
		[300, this.world.height -900, 'donut'],
		[365, this.world.height -900, 'schnitten'],
		[165, this.world.height -1100, 'muffin'],
		[85, this.world.height -1100, 'schoki'],
		[5, this.world.height -1100, 'donut'],
		[450, this.world.height -1100, 'muffin'],
		[540, this.world.height -1100, 'schoki'],
		[630, this.world.height -1100, 'donut'],
		[720, this.world.height -1100, 'schnitten'],
		[685, this.world.height -700, 'muffin'],
		[785, this.world.height -700, 'schoki'],
		[885, this.world.height -700, 'donut'],
		[985, this.world.height -700, 'schnitten'],
		[1280, this.world.height -700, 'muffin'],
		[1480, this.world.height -1100, 'schoki'],
		[1758, this.world.height -1100, 'donut'],
		[1668, this.world.height -1100, 'schnitten'],
		[1866, this.world.height -720, 'muffin'],
		[1637, this.world.height -570, 'schoki'],
		[1422, this.world.height -590, 'donut'],
		[1199, this.world.height -590, 'muffin'],
		[1130, this.world.height -590, 'schnitten'],
		[1305, this.world.height -300, 'schoki'],
		[1605, this.world.height -280, 'donut']
	];

	for(var i = 0; i < foodsMap.length; i++) {
		var food = this.foods.create(foodsMap[i][0], foodsMap[i][1], foodsMap[i][2]);
		food.body.gravity.y = 300;
		food.body.bounce.y = 0.2 + Math.random() * 0.5;
	}
	// this.winFood = this.foods.create(100, this.world.height -400, 'schoki');
	// this.winFood.body.gravity.y = 300;
	// this.winFood.body.bounce.y = 0.2 + Math.random() * 0.5;
		
	this.scoreText = this.add.text(16, 16, 'Score: 0', { fontSize: '64px', fill: '#000000'});
	this.timeText = this.add.text(180, 16, '', { fontSize: '64px', fill: '#000000'} );
	this.cursors = this.input.keyboard.createCursorKeys();	
	this.score = 0;
}	

raimund.gameState.prototype.update = function() {
	this.game.physics.arcade.collide(this.player, this.blocks);
	this.game.physics.arcade.collide(this.foods, this.blocks);
	
	this.game.physics.arcade.overlap(this.player, this.walls, this.killPlayer, null, this);
	this.game.physics.arcade.overlap(this.player, this.foods, this.collectFood, null, this);
	
	this.player.body.velocity.x = 0;
	
	var cursorDown = false;
	if (this.cursors.left.isDown)
	{
		this.player.body.velocity.x = -165;
		this.player.animations.play('left');
		cursorDown = true;
	} else if (this.cursors.right.isDown) {
		this.player.body.velocity.x = 165;
		this.player.animations.play('right');	
		cursorDown = true;
	} else {
		this.player.animations.stop();
		this.player.frame = 4;
	}
	
	if (this.cursors.up.isDown && this.player.body.touching.down)
	{
		this.player.body.velocity.y = -640;
		cursorDown = true;
	}

	if(!this.player.body.touching.down) {
		if(this.player.body.velocity.x > 0) {
			this.player.frame = 8;
			this.player.animations.stop();
		} else if(this.player.body.velocity.x < 0) {			
			this.player.frame = 0;
			this.player.animations.stop();
		} else {
			this.player.frame = 4;
			this.player.animations.stop();			
		}

	}

	if(!this.started && cursorDown) {
		this.sound.play();
		this.startTime = this.game.time.totalElapsedSeconds();
		this.started = true;
	}

	if(this.started)
		this.timeText.text = Math.round((this.time.totalElapsedSeconds() - this.startTime) * 100) / 100;
	
	if(this.player.body.y > this.world.height ||
		this.player.body.x > this.world.width ||
		this.player.body.x < -this.player.body.width) {
		this.sound.stop();
		this.state.start('Lose');
	}
		
}
	
raimund.gameState.prototype.killPlayer = function(player, wall) {
	player.kill();
	this.sound.stop();
	this.state.start('Lose');
}
	
raimund.gameState.prototype.collectFood = function(player, food) {
	food.kill();
	this.score += 10;
	this.scoreText.text = "Score: " + this.score;

	if(food == this.winFood) {
		this.sound.stop();
		this.state.start('Win', true, false, Math.round((this.time.totalElapsedSeconds() - this.startTime) * 100) / 100);
	}
}


raimund.startState = function() {

}

raimund.startState.prototype.preload = function() {
	this.scale.maxWidth = 1920;
    this.scale.maxHeight = 900;
	this.scale.scaleMode = Phaser.ScaleManager.SHOW_ALL;
    this.scale.setScreenSize();
}

raimund.startState.prototype.create = function() {
	this.stage.backgroundColor = "#ffffff";
	this.add.sprite(0, 0, 'background');

	this.add.text(this.world.centerX - 400, this.world.centerY - 50, "Raimund von Mathelonien");
	var button = this.add.text(this.world.centerX - 400, this.world.centerY, "Los mit Raimund", {font: "20px Arial", fill: "#ff0000"});

	this.add.text(this.world.centerX, this.world.centerY, 
		"Anleitung\nDamit Du das Spiel super spielen kannst befolge folgende Punkte:" + 
		"\n* Berühre keine Wände" +
		"\n* Raimund mag keine Shrimps",
		{font: "20px Arial", fill: "#666666"}
	);

	button.inputEnabled = true;
	button.input.useHandCursor = true;
	button.events.onInputUp.add(this.start, this);
}

raimund.startState.prototype.update = function() {

}

raimund.startState.prototype.start = function() {
	this.state.start('Start', true, false);
}

raimund.winState = function() {
	this.time;
}

raimund.winState.prototype.preload = function() {
}

raimund.winState.prototype.init = function(time) {
	this.time = time;
}

raimund.winState.prototype.create = function() {
	this.stage.backgroundColor = "#ffffff";
	this.add.text(this.world.centerX, this.world.centerY - 50, "Yeah, du hast gewonnen in " + this.time + "s");
	var button = this.add.text(this.world.centerX, this.world.centerY, "Lass Raimund nochmals schlemmen", {font: "20px Arial", fill: "#ff0000"});
	button.inputEnabled = true;
	button.input.useHandCursor = true;
	button.events.onInputUp.add(this.start, this);

}

raimund.winState.prototype.update = function() {
	
}

raimund.winState.prototype.start = function() {
	this.state.start('Game', true, false);
}

raimund.loseState = function() {

}

raimund.loseState.prototype.preload = function() {

}

raimund.loseState.prototype.create = function() {
	this.stage.backgroundColor = "#ffffff";
	this.add.text(this.world.centerX, this.world.centerY - 50, "Du hast leider verloren");
	var button = this.add.text(this.world.centerX, this.world.centerY, "Gib Raimund noch eine Chance", {font: "20px Arial", fill: "#ff0000"});
	button.inputEnabled = true;
	button.input.useHandCursor = true;
	button.events.onInputUp.add(this.start, this);
}

raimund.loseState.prototype.update = function() {
	
}

raimund.loseState.prototype.start = function() {
	this.state.start('Game', true, false);
}

raimund.preloadState = function() {

}
raimund.preloadState.prototype.preload = function() {

    var loadingBar = this.add.sprite(
        this.world.centerX,
        this.world.centerY,
        'loading'
    );
    loadingBar.anchor.setTo(0.5, 0.5);

    this.load.setPreloadSprite(loadingBar);

    this.load.image('loading', 'assets/loading.png');
	this.load.audio('bg-sound', 'soundtrack.mp3');

	this.load.image('background', 'assetsbimbo/background.png');
	this.load.image('background-start', 'assetsbimbo/background-start.png');
	this.load.image('block800', 'assetsbimbo/block800.png');
	this.load.image('block500', 'assetsbimbo/block500.png');
	this.load.image('block400', 'assetsbimbo/block400.png');
	this.load.image('block300', 'assetsbimbo/block300.png');
	this.load.image('block200', 'assetsbimbo/block200.png');
	this.load.image('block100', 'assetsbimbo/block100.png');
	this.load.image('block50', 'assetsbimbo/block50.png');
	
	this.load.image('wand217', 'assetsbimbo/wand217.png');
	this.load.image('wand580', 'assetsbimbo/wand580.png');
	this.load.image('wand150', 'assetsbimbo/wand150.png');
	this.load.image('wandho115', 'assetsbimbo/wandho115.png');
	this.load.image('wand110', 'assetsbimbo/wand110.png');
	this.load.image('wand80', 'assetsbimbo/wand80.png');
	this.load.image('wandho150', 'assetsbimbo/wandho150.png');
	this.load.image('wand30', 'assetsbimbo/wand30.png');
	
	this.load.image('donut', 'assetsbimbo/donut.png');
	this.load.image('donuts', 'assetsbimbo/donuts.png');
	this.load.image('muffin', 'assetsbimbo/muffin.png');
	this.load.image('schnitten', 'assetsbimbo/schnitten.png');
	this.load.image('schoki', 'assetsbimbo/schoki.png');
	
	this.load.spritesheet('bimbo', 'assetsbimbo/bimbo.png', 45, 96);
}
raimund.preloadState.prototype.update = function() {

}
raimund.preloadState.prototype.create = function() {
	this.game.state.start('Start');
}

raimund.bootState = function() {

}
raimund.bootState.prototype.preload = function() {
        this.game.load.image('loading', 'assets/loading.png');
}
raimund.bootState.prototype.update = function() {
}
raimund.bootState.prototype.create = function() {

    this.game.scale.pageAlignHorizontally = true;
    this.game.scale.pageAlignVertically = true;
    this.game.scale.scaleMode = Phaser.ScaleManager.SHOW_ALL;
    this.game.scale.setScreenSize(true);
	this.game.state.start('Preloader');
}

var game = new Phaser.Game(
	1920,
	900, 
	Phaser.AUTO, 
	'raimund'
);
game.state.add('Boot', raimund.bootState);
game.state.add('Preloader', raimund.preloadState);
game.state.add('Start', raimund.startState);
game.state.add('Game', raimund.gameState);
game.state.add('Lose', raimund.loseState);
game.state.add('Win', raimund.winState);
game.state.start('Boot');
</script>

</body>
</html>
